'date: 2015/11/12
'main_maintainer:	Darkangeel_hd	https://github.com/DarkminecrafterHD

'TESTING BUILD!!!!'
'This is a testing build
'Is not garantee to work in any way

SET !EXTRACT_TEST_POPUP NO
SET !ERRORIGNORE YES
SET !TIMEOUT_PAGE 999
SET !TIMEOUT_STEP 999



'=== CONFIGURATION ==='

SET url http://freebitco.in/?r=1327941

'= Login settings ='

'Used when login-in by BTC address'
SET btc YOURBTCADRESS
'Used when login-in by mail'
SET mail mail
'The password of your freebetco.in account'
SET pw pass


'= API KEY ='
'API key from 9kw.eu'
SET apikey API_KEY


'= Path and captcha settings ='
'path where captchas will be temporaly sabed'
SET path temp_path
'filename of the saved captcha'
SET file freebitcoin_{{!NOW:yyyymmdd_hhnnss}}.jpg
'''SET file freebitcoin.jpg


'And priority (prio 1-20)
'Priority in our system like min. 0 to max. 20 (cost +0-20)
SET priority 0



'=== END OF CONFIG ==='



'Open the page'
TAB OPEN
TAB T=1
TAB CLOSEALLOTHERS
SET !TIMEOUT_PAGE 10
URL GOTO={{url}}

'Login in'
TAG POS=1 TYPE=BUTTON ATTR=ID:switch_to_login_button
TAG POS=1 TYPE=INPUT:TEXT FORM=ID:login_form ATTR=ID:login_form_btc_address CONTENT={{mail}}
SET !ENCRYPTION NO
TAG POS=1 TYPE=INPUT:PASSWORD FORM=ID:login_form ATTR=ID:login_form_password CONTENT={{pw}}
EVENT TYPE=CLICK SELECTOR="#login_button" BUTTON=0
WAIT SECONDS=5

'Push claim button'
TAG POS=1 TYPE=A ATTR=TXT:CLAIM<SP>YOUR<SP>FREE<SP>BTC<SP>NOW!
WAIT SECONDS=5


''Delete old captcha image'			This code is useless since now captchas are
''FILEDELETE NAME={{path}}{{file}}		given name by date and deletted after use

'Download path and name'
ONDOWNLOAD FOLDER={{path}} FILE={{file}}

'Switch captcha type'
TAG POS=1 TYPE=SELECT ATTR=ID:free_play_captcha_types CONTENT=%solvemedia
WAIT SECONDS=2

'Save captcha image'
TAG POS=1 TYPE=DIV ATTR=ID:adcopy-puzzle-image CONTENT=EVENT:SAVE_ELEMENT_SCREENSHOT

'Wait a random number (1 to 5) of seconds
SET WAIT_TM_0 EVAL("Math.floor(Math.random()*5 + 1);")
WAIT SECONDS={{WAIT_TM_0}}


'Syntaxcheck: API Key, prio
SET API_KEY EVAL("var s=\"{{apikey}}\"; if(s.match(/^[a-zA-Z0-9]+$/) && s.length <= 50 && s.length >= 5) s; else MacroError(\"API Key is wrong.\")")
SET PRIORITY EVAL("var s=\"{{priority}}\", d = parseFloat(s); if(d >= 0 && d <= 20) d; else MacroError(\"Value(Prio) is not in the set range.\")")


'Request captcha solving'
TAB OPEN
TAB T=2
URL GOTO=http://www.9kw.eu/grafik/form.html
TAG POS=1 TYPE=INPUT ATTR=NAME:apikey CONTENT={{apikey}}
'Priority in our system like min. 0 to max. 20 (cost +0-20)
TAG POS=1 TYPE=INPUT ATTR=NAME:prio CONTENT={{priority}}
'Options for the form. See more under http://www.9kw.eu/grafik/form.html and http://www.9kw.eu/api.html
TAG POS=1 TYPE=INPUT:CHECKBOX FORM=ACTION:/index.cgi ATTR=NAME:selfsolve CONTENT=NO
TAG POS=1 TYPE=INPUT:CHECKBOX FORM=ACTION:/index.cgi ATTR=NAME:confirm CONTENT=NO
TAG POS=1 TYPE=INPUT:CHECKBOX FORM=ACTION:/index.cgi ATTR=NAME:case-sensitive CONTENT=NO
'TAG POS=1 TYPE=INPUT:CHECKBOX FORM=ACTION:/index.cgi ATTR=NAME:nomd5 CONTENT=YES
TAG POS=1 TYPE=INPUT ATTR=NAME:source CONTENT=imacros
'The path of the captcha picture saved is assigned to the CONTENT
TAG POS=1 TYPE=INPUT ATTR=NAME:file-upload-01 CONTENT={{path}}{{file}}
'Submit the formdata to 9kw.eu
TAG POS=1 TYPE=INPUT ATTR=TYPE:submit

'Extract the captchaid from your captcha submit
TAG POS=1 TYPE=INPUT ATTR=NAME:captchaid EXTRACT=TXT
SET captcha_ID {{!EXTRACT}}
'Clean the !EXTRACT variable for the next task
SET !EXTRACT NULL

'Extract the characters that are recoginzed from the picture of captcha.
SET !TIMEOUT_STEP 300
TAG POS=1 TYPE=INPUT ATTR=NAME:result EXTRACT=TXT
TAB CLOSE
TAB T=1

'Display extracted data (only for debug)
'PROMPT {{captcha_ID}}

'Check the captcha answer (text or nothing like #EANF# = Extraction Anchor Not Found)
SET Answer EVAL("if (\"{{!EXTRACT}}\" == \"#EANF#\") {var x = \"\";} else {var x = \"{{!EXTRACT}}\";} x;")
'Clean the !EXTRACT variable for the next task
SET !EXTRACT NULL


TAB T=1
TAG POS=1 TYPE=INPUT ATTR=ID:adcopy_response CONTENT={{Answer}}
WAIT SECONDS=10
TAG POS=1 TYPE=INPUT:SUBMIT FORM=ID:fcaptcha ATTR=*
TAG POS=1 TYPE=INPUT:SUBMIT ATTR=ID:free_play_form_button

'Check and send the captcha feedback back to the captcha service (OK:1, NotOK:2, EN: Right/False, DE: Richtig/Falsch)
SEARCH SOURCE=REGEXP:"(Incorrect captcha entered|You win)" IGNORE_CASE=YES EXTRACT="$1"
SET Feedback {{!EXTRACT}}
'Display extracted data (only for debug)
'PROMPT {{!EXTRACT}}
'Clean the !EXTRACT variable
SET !EXTRACT NULL
SET Feedback EVAL("if (\"{{Feedback}}\" == \"Incorrect captcha entered\") {var x = \"2\";} else {var x = \"1\";} x;")
TAB OPEN
TAB T=2
URL GOTO=http://www.9kw.eu/index.cgi?source=imacros&action=usercaptchacorrectback&apikey={{API_KEY}}&correct={{feedback}}&id={{captcha_ID}}
WAIT SECONDS=2
TAB CLOSE
TAB T=1

'Cleanup: Delete the old captcha picture
FILEDELETE NAME={{PATH}}{{FILE}}

WAIT SECONDS=3620
